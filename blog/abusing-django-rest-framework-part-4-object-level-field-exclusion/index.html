<!doctype html><html lang=en-us><head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width">
<title>Abusing Django Rest Framework Part 4: Object-level field exclusion</title>
<link rel=alternate type=application/rss+xml title=RSS href=https://jsatt.com/blog/feeds/rss/>
<link rel=alternate type=application/atom+xml title=Atom href=https://jsatt.com/blog/feeds/atom/>
<link rel=stylesheet href=../../static/css/bootstrap.min.css>
<link rel=stylesheet href=../../static/css/font-awesome.min.css>
<link rel=stylesheet href=../../static/css/prism.css>
<link rel=stylesheet href=../../static/css/main.css>
</head>
<body id=page_blog_post><header>
<nav>
<div class=container>
<div class=row>
<div class=col-md-12>
<ul class="nav navbar-nav">
<li id=menu-link-blog><a href=https://jsatt.com/blog/>Blog</a></li>
<li id=menu-link-about><a href=https://jsatt.com/about/>About</a></li>
</ul>
</div>
</div>
</div>
</nav>
<div class=title><a href=../../>Jeremy Satterfield</a></div>
<div class=tagline>Coding, Making and Tulsa Life</div>
</header>
<section id=content>
<div class=container>
<div class=row>
<article class=col-md-8 itemscope itemtype=http://schema.org/BlogPosting>
<h1 class=headline itemprop=headline>Abusing Django Rest Framework Part 4: Object-level field exclusion</h1>
<h6 class=post-meta>
Posted by:
<span itemscope itemprop=author itemtype=http://schema.org/Person>
<span itemprop=name>Jeremy Satterfield</span>
</span>
in
<a itemprop=articleSection href=https://jsatt.com/categories/development/>development</a>
on <span itemprop=datePublished>2014-03-27</span>
<ul class="list-inline tags">
<li>Tags:</li>
<li><a href=https://jsatt.com/tags/django/>django</a></li><li><a href=https://jsatt.com/tags/django-rest-framework/>django rest framework</a></li><li><a href=https://jsatt.com/tags/python/>python</a></li><li><a href=https://jsatt.com/tags/hacks/>hacks</a></li>
</ul>
</h6>
<div class=post itemprop=articleBody>
<p>Similar to the object-level readonly field from my <a href=../../blog/abusing-django-rest-framework-part-3-object-level-read-only-fields/>previous post</a>, there are some cases where we want to exclude certain fields based on what object the user is trying to access. You could overwrite the views <code>get_serializer</code> method to use a different serializer based on their access, but if nesting serializers is a possiblility this get messy, somewhere in the neighborhood of <a href=http://rob-bell.net/2009/06/a-beginners-guide-to-big-o-notation/ target=_blank>O(n<sup>2</sup>)</a>. Another option is to modify a serializers <code>to_native</code> method.</p>
<pre>
<code class=language-python>class SampleSerializer(serializers.ModelSerializer):
    ...

    def to_native(self, obj):
        restricted = not obj.review_set.filter(
            client__plan__account_details=True).exists()

        if restricted:
            self.fields.pop(&#39;billing_address&#39;, None)
        return super(SampleSerializer, self).to_native(obj)</code></pre>
<p>The <code>to_native</code> method is responsible for turning the Python object into a simple, serializable value. This means it has to be called for every object that it being retrieved, so it will always be able to affect your output, even when nested.</p>
<p>One drawback is that it only works in conjunction with retrieve views. If the field is defined in the serializer at any point as writeable, the users can still update that field, even if they can't see it. This can be a pretty big security risk when used with update views.</p>
<h2>Another Approach</h2>
<p>Having implemented this method several months ago, based on a spec that was several months old at the time, I would likely approach the root issue from a different angle if it came up again. Maybe creating updating the spec to have a consistant api response and return blank values for the unauthorized fields would be a better approach. <code>SerializerMthodField</code> has the potential to make this approach much cleaner.</p>
</div>
</article>
<aside class=col-md-4>
<nav class=social-icons>
<a href=https://github.com/jsatt rel=me target=_blank><i class="fa fa-github-square"></i></a>
<a href=https://www.facebook.com/jsatt0 rel=me target=_blank><i class="fa fa-facebook-square"></i></a>
<a href=https://twitter.com/jsatt rel=me target=_blank><i class="fa fa-twitter-square"></i></a>
<a href=https://www.linkedin.com/in/jsatterfield rel=me target=_blank><i class="fa fa-linkedin-square"></i></a>
<a href=mailto:jsatt@jsatt.com><i class="fa fa-envelope"></i></a>
<a href target=_blank><i class="fa fa-rss-square"></i></a>
</nav>
<div id=related-posts>
<div class=related-post>
<a href=https://jsatt.com/blog/abusing-django-rest-framework-part-3-object-level-read-only-fields/>Abusing Django Rest Framework Part 3: Object-level read-only fields</a>
<div class=timesince>2014-03-26</div>
</div>
<div class=related-post>
<a href=https://jsatt.com/blog/abusing-django-rest-framework-part-2-non-rate-based-throttling/>Abusing Django Rest Framework Part 2: Non-rate-based Throttling</a>
<div class=timesince>2014-02-19</div>
</div>
<div class=related-post>
<a href=https://jsatt.com/blog/abusing-django-rest-framework-part-1-non-model-endpoints/>Abusing Django Rest Framework Part 1: Non-Model Endpoints</a>
<div class=timesince>2014-01-29</div>
</div>
</div>
<div class=keywords>
<div class=keyword>
<a href=https://jsatt.com/tags/python/>#python</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/testing/>#testing</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/django/>#django</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/hacks/>#hacks</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/mocking/>#mocking</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/django-rest-framework/>#django-rest-framework</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/celery/>#celery</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/class-based-views/>#class-based-views</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/data-structures/>#data-structures</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/dev-ops/>#dev-ops</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/docker/>#docker</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/go/>#go</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/linux/>#linux</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/node/>#node</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/nose/>#nose</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/open-source/>#open-source</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/packages/>#packages</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/ruby/>#ruby</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/rust/>#rust</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/tox/>#tox</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/travis-ci/>#travis-ci</a>
</div>
<div class=keyword>
<a href=https://jsatt.com/tags/virtualenvs/>#virtualenvs</a>
</div>
</div>
</aside>
</div>
</div>
</section><footer>
<div class=container>
<div class=row>
<div class=col-md-12>
<div class=nav-footer>
<ul class=list-unstyled>
<li id=footer-menu-presentations><a href=https://jsatt.com/presentations/>Presentations</a></li>
<li id=footer-menu-resume><a href=https://jsatt.com/resume/>Resume</a></li>
</ul>
</div>
</div>
</div>
</div>
</footer>
<script src=../../static/js/jquery.min.js></script>
<script src=../../static/js/prism.js></script>
<script src=../../static/js/bootstrap.min.js></script>
</body>
</html>