<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width"><title>Unit Testing Recursion in Python</title><link rel=alternate type=application/rss+xml title=RSS href=https://jsatt.com/blog/feeds/rss/><link rel=alternate type=application/atom+xml title=Atom href=https://jsatt.com/blog/feeds/atom/><link rel=stylesheet href=../../static/css/bootstrap.min.css><link rel=stylesheet href=../../static/css/fontawesome.min.css><link rel=stylesheet href=../../static/css/prism.css><link rel=stylesheet href=../../static/css/main.css></head><body id=page_blog_post><header><nav><div class=container><div class=row><div class=col-md-12><ul class="nav navbar-nav"><li id=menu-link-blog><a href=https://jsatt.com/blog/>Blog</a></li><li id=menu-link-about><a href=https://jsatt.com/about/>About</a></li></ul></div></div></div></nav><div class=title><a href=../../>Jeremy Satterfield</a></div><div class=tagline>Coding, Making and Tulsa Life</div></header><section id=content><div class=container><div class=row><article class=col-md-8 itemscope itemtype=http://schema.org/BlogPosting><h1 class=headline itemprop=headline>Unit Testing Recursion in Python</h1><h6 class=post-meta>Posted by:
<span itemscope itemprop=author itemtype=http://schema.org/Person><span itemprop=name>Jeremy Satterfield</span></span>
in
<a itemprop=articleSection href=https://jsatt.com/categories/development/>development</a>
on <span itemprop=datePublished>2014-12-11</span><ul class="list-inline tags"><li>Tags:</li><li><a href=https://jsatt.com/tags/hacks/>hacks</a></li><li><a href=https://jsatt.com/tags/mocking/>mocking</a></li><li><a href=https://jsatt.com/tags/python/>python</a></li><li><a href=https://jsatt.com/tags/testing/>testing</a></li></ul></h6><div class=post itemprop=articleBody><p>Today I finally figured out the solution to a problem I've been trying to solve for a while. It's kind of hacky and maybe a bad idea, but now I know it's possible. The problem has always been that I'd like to test that a function recurses, but not needing it to actually have the recursion execute within to test. Just a unit test to assert that recursion is happening. After a little thought about how Python stores references I came up with this.</p><pre class=language-python>
<code>class ExampleTest(TestCase):
    def setUp(self):
        self.task = Task()
    # ...
    # other test stuff
    # ...

    def test_recursion(self):
        original_func = self.task.run
        self.mock.StubOutWithMock(Task, &#39;run&#39;)

        Task.run(id=44)

        self.mock.ReplayAll()
        original_func(id=22)
        self.mock.VerifyAll()
</code></pre><p>Because variables in Python are just references to objects in memory, if you create a new reference before stubbing out the primary reference, pointing it to a mock object, you can still access it via this new reference. You're now free to check that recusion is happening, without the need for it to actually recurse in the test.</p></div></article><aside class=col-md-4><nav class=social-icons><a href=https://github.com/jsatt rel=me target=_blank><i class="fa-brands fa-github" title="Github: jsatt"></i></a>
<a href=https://www.facebook.com/jsatt0 rel=me target=_blank><i class="fa-brands fa-facebook" title="Facebook: jsatt0"></i></a>
<a href=https://twitter.com/jsatt rel=me target=_blank><i class="fa-brands fa-twitter" title="Twitter: @jsatt"></i></a>
<a href=https://fosstodon.org/web/@jsatt rel=me target=_blank><i class="fa-brands fa-mastodon" title="Mastodon: @jsatt@fosstodon.org"></i></a>
<a href=https://www.linkedin.com/in/jsatterfield rel=me target=_blank><i class="fa-brands fa-linkedin" title="Linkedin: jsatterfield"></i></a>
<a href=mailto:jsatt@jsatt.com><i class="fa-solid fa-envelope" title="Email: jsatt@jsatt.com"></i></a>
<a href=https://jsatt.com/blog/feeds/rss/ target=_blank><i class="fa-solid fa-square-rss" title=RSS></i></a></nav><div id=related-posts><div class=related-post><a href=https://jsatt.com/blog/python-catalog/>Python Catalog Data Structures</a><div class=timesince>2017-11-10</div></div><div class=related-post><a href=https://jsatt.com/blog/mocking-a-property-in-python/>Mocking a property in Python</a><div class=timesince>2014-08-08</div></div><div class=related-post><a href=https://jsatt.com/blog/mocking-pythons-built-in-open-function/>Mocking Python&amp;#39;s built-in open function</a><div class=timesince>2014-04-11</div></div><div class=related-post><a href=https://jsatt.com/blog/mocking-context-managers-in-python/>Mocking Context Managers in Python</a><div class=timesince>2014-02-28</div></div></div><div class=keywords><div class=keyword><a href=https://jsatt.com/tags/python/>#python</a></div><div class=keyword><a href=https://jsatt.com/tags/testing/>#testing</a></div><div class=keyword><a href=https://jsatt.com/tags/django/>#django</a></div><div class=keyword><a href=https://jsatt.com/tags/hacks/>#hacks</a></div><div class=keyword><a href=https://jsatt.com/tags/mocking/>#mocking</a></div><div class=keyword><a href=https://jsatt.com/tags/django-rest-framework/>#django-rest-framework</a></div><div class=keyword><a href=https://jsatt.com/tags/celery/>#celery</a></div><div class=keyword><a href=https://jsatt.com/tags/class-based-views/>#class-based-views</a></div><div class=keyword><a href=https://jsatt.com/tags/data-structures/>#data-structures</a></div><div class=keyword><a href=https://jsatt.com/tags/dev-ops/>#dev-ops</a></div><div class=keyword><a href=https://jsatt.com/tags/docker/>#docker</a></div><div class=keyword><a href=https://jsatt.com/tags/go/>#go</a></div><div class=keyword><a href=https://jsatt.com/tags/linux/>#linux</a></div><div class=keyword><a href=https://jsatt.com/tags/node/>#node</a></div><div class=keyword><a href=https://jsatt.com/tags/nose/>#nose</a></div><div class=keyword><a href=https://jsatt.com/tags/open-source/>#open-source</a></div><div class=keyword><a href=https://jsatt.com/tags/packages/>#packages</a></div><div class=keyword><a href=https://jsatt.com/tags/ruby/>#ruby</a></div><div class=keyword><a href=https://jsatt.com/tags/rust/>#rust</a></div><div class=keyword><a href=https://jsatt.com/tags/tox/>#tox</a></div><div class=keyword><a href=https://jsatt.com/tags/travis-ci/>#travis-ci</a></div><div class=keyword><a href=https://jsatt.com/tags/virtualenvs/>#virtualenvs</a></div></div></aside></div></div></section><footer><div class=container><div class=row><div class=col-md-12><div class=nav-footer><ul class=list-unstyled><li id=footer-menu-presentations><a href=https://jsatt.com/presentations/>Presentations</a></li><li id=footer-menu-resume><a href=https://jsatt.com/resume/>Resume</a></li></ul></div></div></div></div></footer><script src=../../static/js/jquery.min.js></script>
<script src=../../static/js/prism.js></script>
<script src=../../static/js/bootstrap.min.js></script></body></html>